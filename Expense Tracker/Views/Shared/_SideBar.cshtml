@*
    Sidebar for Expense Tracker
*@

@{
    var username = ViewContext.HttpContext.Request.Query["username"].ToString();
    // get username from URL
    // Define menu items
    var menuItems = new List<object>
    {
        new { text = "General", separator = true },
        new { text = "Dashboard", url = $"/Dashboard/Index?username={username}", iconCss = "fa-solid fa-box" },
        new { text = "Categories", url = $"/Category/Index?username={username}", iconCss = "fa-solid fa-folder-closed" },
        new { text = "Transactions", url = $"/Transaction/Index?username={username}", iconCss = "fa-solid fa-arrow-right-arrow-left" },
        new { text = "Extras", separator = true },
        new { text = "Reports", iconCss = "fa-solid fa-chart-simple", url = "javascript:downloadReportWithUser();" },
        new { text = "Settings", iconCss = "fa-solid fa-gear", url = "#" },
    };
}

<ejs-sidebar id="sidebar" width="290px" enableDock dockSize="100px" target=".dock-target" enableGestures="false">
    <e-content-template>
        <div class="logo-wrapper">
            <div class="app-logo">
                <img src="~/logo.png" />
            </div>
            <div class="w-100"></div>
            <i id="sidebar-toggler" class="fa-solid"></i>
        </div>

        <div class="profile-wrapper">
            <img class="profile-pic" src="~/DefaultPhoto.jpeg" />
            <div class="titles d-flex flex-column ps-3">
                <h6 class="mb-0">Wallet App</h6>
                @* <span class="text-muted" id="profileUsername">Guest</span> *@
                @if (User.Identity != null && User.Identity.IsAuthenticated)
                {
                    <span class="text-muted">@User.Identity.Name</span>
                }
                else
                {
                    <span class="text-muted">Guest</span>
                }
            </div>
        </div>

        <ejs-menu id="menu"
                  items="menuItems"
                  orientation="Vertical"
                  hamburgerMode></ejs-menu>

        <!-- ADD THIS LOGOUT FORM -->
        <div class="mt-auto p-3">
            <form asp-controller="Account" asp-action="Logout" method="post">
                <button type="submit" class="btn btn-danger w-100">
                    <i class="fa-solid fa-right-from-bracket"></i> Logout
                </button>
            </form>
        </div>

    </e-content-template>
</ejs-sidebar>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Sidebar toggle
        var dockBar = document.getElementById('sidebar').ej2_instances[0];
        document.getElementById('sidebar-toggler').onclick = function () {
            dockBar.toggle();
        };

    });

    // Function for downloading reports
    function downloadReportWithUser() {
        // Simply navigate to the secure download endpoint.
        // The browser will automatically send the authentication cookie.
        window.location.href = '/Dashboard/DownloadReport';
    }
</script>
